<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyMVC Documentation</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <a href="https://tinymvc.github.io" class="logo">
            <span>TinyMVC</span> <sup class="version">v1.x</sup>
        </a>
        <a href="https://github.com/tinymvc/tinymvc" class="github-link">
            <svg height="20" viewBox="0 0 16 16" width="20" style="margin-right: 5px;">
                <path fill="currentColor" fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
            GitHub
        </a>
    </header>

    <div class="main-container">
        <nav class="sidebar">
            <a href="/">Introduction</a>

            <h2>Getting Started</h2>
            <ul>
                <li><a href="/installation">Installation</a></li>
                <li><a href="/configuration">Configuration</a></li>
                <li><a href="/quick-start">Quick Start</a></li>
            </ul>

            <h2>The Basics</h2>
            <ul>
                <li><a href="/routing">Routing</a></li>
                <li><a href="/controllers">Controllers</a></li>
                <li><a href="/request">Request</a></li>
                <li><a href="/response">Response</a></li>
                <li><a href="/blade">Blade</a></li>
            </ul>

            <h2>Database</h2>
            <ul>
                <li><a href="/database" class="active">DB</a></li>
                <li><a href="/query-builder">Query Builder</a></li>
                <li><a href="/migrations">Migrations</a></li>
                <li><a href="/models">Models</a></li>
            </ul>

            <h2>Security</h2>
            <ul>
                <li><a href="/middleware">Middleware</a></li>
                <li><a href="/cors-and-csrf-protection">CORS & CSRF Protection</a></li>
                <li><a href="/authentication">Authentication</a></li>
                <li><a href="/authorization">Authorization</a></li>
            </ul>

            <h2>Features</h2>
            <ul>
                <li><a href="/container">Container</a></li>
                <li><a href="/encryption">Encryption</a></li>
                <li><a href="/queues">Queues</a></li>
                <li><a href="/events">Events</a></li>
                <li><a href="/asset-bundling">Asset Bundling (Vite)</a></li>
                <li><a href="/localization">Localization</a></li>
                <li><a href="/session">Session</a></li>
                <li><a href="/pipeline">Pipeline</a></li>
                <li><a href="/spark-cli">Spark CLI</a></li>

            </ul>

            <h2>Utilities</h2>
            <ul>
                <li><a href="/helpers-and-utilities#http-utility">Http (cURL)</a></li>
                <li><a href="/helpers-and-utilities#uploader-utility">Uploader</a></li>
                <li><a href="/helpers-and-utilities#paginator-utility">Paginator</a></li>
                <li><a href="/helpers-and-utilities#mail-utility">Mail</a></li>
                <li><a href="/helpers-and-utilities#cache-utility">Cache</a></li>
                <li><a href="/helpers-and-utilities#image-utility">Image</a></li>
                <li><a href="/helpers-and-utilities#filemanager-utility">File Manager</a></li>
                <li><a href="/helpers-and-utilities#time-utility">Carbon Time</a></li>
            </ul>

            <a href="/contribution">❤️ Contribution</a>
        </nav>
        <div class="content">
            <section id="database">
                <h2>Database Abstraction Layer</h2>
                <p>The DB class provides a robust database abstraction layer with support for multiple database drivers,
                    connection management, and query building.</p>

                <div class="note">
                    <strong>Note:</strong> The DB class implements PDO (PHP Data Objects) under the hood, providing a
                    secure and consistent interface for database operations.
                </div>

                <h3>Configuration</h3>
                <p>Database configuration is typically set in your application's configuration file:</p>

                <h4>SQLite Configuration</h4>
                <pre><code>'database' => [
    'driver' => 'sqlite',
    'file' => __DIR__ . '/database/sqlite.db',
    'options' => [
        PDO::ATTR_PERSISTENT => true
    ]
]</code></pre>

                <h4>MySQL Configuration</h4>
                <pre><code>'database' => [
    'driver' => 'mysql',
    'host' => 'localhost',
    'port' => 3306,
    'name' => 'my_database',
    'user' => 'db_user',
    'password' => 'secure_password',
    'charset' => 'utf8mb4',
    'collation' => 'utf8mb4_unicode_ci',
    'options' => [
        PDO::ATTR_PERSISTENT => true,
        PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES 'utf8mb4'"
    ]
]</code></pre>

                <h4>PostgreSQL Configuration</h4>
                <pre><code>'database' => [
    'driver' => 'pgsql',
    'host' => 'localhost',
    'port' => 5432,
    'name' => 'my_database',
    'user' => 'db_user',
    'password' => 'secure_password',
    'options' => [
        PDO::ATTR_PERSISTENT => true
    ]
]</code></pre>

                <h3>Initialization</h3>
                <p>Get a database instance using helper functions:</p>
                <pre><code>// Get default database connection
$db = database();

// Alternative helper
$db = db();

// Create custom connection
$externalDb = connect_db([
    'driver' => 'mysql',
    'host' => 'external.db.host',
    // ... other config
]);</code></pre>

                <h3>Core Functionality</h3>

                <h4>Direct PDO Access</h4>
                <pre><code>// Get PDO instance
$pdo = database()->getPdo();

// Execute raw SQL
$stmt = database()->query('SELECT * FROM users');

// Prepare statement
$stmt = database()->prepare('SELECT * FROM users WHERE id = ?');
$stmt->execute([1]);</code></pre>

                <h4>Connection Management</h4>
                <pre><code>// Check driver type
if (database()->isMySQL()) {
    // MySQL specific logic
}

// Reset connection with new config
database()->resetConfig([
    'driver' => 'sqlite',
    'file' => 'new_database.db'
]);

// Force reconnect
database()->resetPdo();</code></pre>

                <h3>Transactions</h3>
                <pre><code>try {
    // Start transaction
    database()->beginTransaction();
    
    // Perform operations
    query('accounts')
        ->where('id', 1)
        ->decrement('balance', 100);
        
    query('accounts')
        ->where('id', 2)
        ->increment('balance', 100);
        
    // Commit if successful
    database()->commit();
} catch (Exception $e) {
    // Rollback on error
    database()->rollback();
    throw $e;
}</code></pre>

                <h3>Query Building</h3>
                <p>The DB class provides static access to QueryBuilder methods:</p>

                <h4>Basic Queries</h4>
                <pre><code>// Select all from table
DB::table('users')->get();

// Select specific columns
DB::table('users')->select('id', 'name')->get();

// Conditional where
DB::table('users')
    ->where('active', 1)
    ->where('age', '>', 18)
    ->get();</code></pre>

                <h4>Aggregates</h4>
                <pre><code>// Count records
$count = DB::table('users')->count();

// Get max value
$maxAge = DB::table('users')->max('age');

// Get average
$avgScore = DB::table('results')->avg('score');</code></pre>

                <h3>Advanced Features</h3>

                <h4>Macros</h4>
                <pre><code>// Register custom macro
DB::macro('getActiveUsers', function() {
    return $this->table('users')
        ->where('active', 1)
        ->get();
});

// Use macro
$activeUsers = DB::getActiveUsers();</code></pre>

                <h4>Custom DSN</h4>
                <pre><code>// Use custom DSN string
$db = new DB([
    'dsn' => 'mysql:unix_socket=/tmp/mysql.sock;dbname=testdb',
    'user' => 'root',
    'password' => ''
]);</code></pre>

                <h3>Driver-Specific Features</h3>

                <h4>SQLite</h4>
                <pre><code>// Enable foreign keys (auto-enabled by DB class)
database()->exec('PRAGMA foreign_keys = ON');

// Use in-memory database
$db = new DB([
    'driver' => 'sqlite',
    'file' => ':memory:'
]);</code></pre>

                <h4>MySQL</h4>
                <pre><code>// Set collation
$db = new DB([
    'driver' => 'mysql',
    // ... other config
    'collation' => 'utf8mb4_unicode_ci'
]);</code></pre>

                <h3>Error Handling</h3>
                <pre><code>try {
    $users = DB::table('users')->where('invalid_column', 'value')->get();
} catch (\PDOException $e) {
    // Handle database errors
    error_log("Database error: " . $e->getMessage());
    return false;
}</code></pre>

                <div class="note warning">
                    <strong>Security Note:</strong> Always use prepared statements or the query builder to prevent SQL
                    injection. Never concatenate user input directly into SQL queries.
                </div>

                <h3>Performance Tips</h3>
                <ul>
                    <li>Use persistent connections for frequently accessed databases</li>
                    <li>Enable query caching where appropriate</li>
                    <li>Use transactions for bulk operations</li>
                    <li>Select only the columns you need</li>
                    <li>Add proper indexes to your tables</li>
                </ul>
            </section>
        </div>
    </div>

    <footer>
        <div class="footer-links">
            <a href="https://github.com/tinymvc/tinymvc">GitHub</a>
            <a href="https://github.com/tinymvc/tinymvc/issues">Issues</a>
            <a href="https://github.com/tinymvc/tinymvc/discussions">Discussions</a>
            <a href="https://github.com/tinymvc/tinymvc/blob/main/LICENSE">License</a>
        </div>
        <div class="copyright">
            &copy; 2023 TinyMVC Framework by <a href="https://github.com/shahinmoyshan">Shahin Moyshan</a>.
        </div>
    </footer>
</body>

</html>